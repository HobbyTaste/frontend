# Hobby-Time  
Текущюю версию сайта в проде можно посмотреть здесь: https://htaste.herokuapp.com/

## Содержание
1. [Настройка окружения и установка необходмых пакетов для разработки (Linux, MacOS)](#settings-env)
2. [Разработка](#dev-rules)
3. [Архитектура backend](#backend) 

<a name="settings-env"></a>

## Подготовка окружения для локальной разработки
Все ниже команды приведены для Unix-систем. Если у вас Windows вы должны искать альтернативные способы по запуску проекта локально самостоятельно. (Есть какая-то [статья](https://losst.ru/ustanovka-bash-v-windows-10) про установку _bash_ на Windows, может она пригодится...)


Итак, готовим рабочее окружение. 
1. Нужно поставить `nvm` (nvm - Node Version Manager, удобная утилита для установки различных версий NodeJS и их использования при запуске нодовых программ)
```
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash
```
2. После этого устанавливаем _node_ 10 версии и ставим его использование по умолчанию при запуске нодовых программ
```
nvm install 10
nvm use default 10
```
Вместе c _node_ установится и `npm`. Чтобы проверить, что установка прошла успешно можно набрать:
```
node --version
npm --version
```
  
3. При установке различных зависимостей и их добавлению в проект я советую пользоваться утилитой `yarn` ([документация](https://yarnpkg.com/)). А [здесь](https://classic.yarnpkg.com/en/docs/install#debian-stable) можно почитать инструкцию по его установке.

4. Для работой с секретами в проекте используется _git secret_. Это позволяет хранить всякие пароли и токены необходимые для работы проекта в зашифрованном виде в репозитории. При этом выдается доступ определенному кругу лиц на расшифровку этих секретов. Подробнее нужно почитать [тут](https://git-secret.io/) как работать с `git secret` + как его установить. Чтобы получить доступ на расшифровку секретов (то есть на использование команды `git secret reveal`) нужно прислать владельцу репозитория ваш публичный сгенерированный gpg ключ (подробнее читать [здесь](https://help.github.com/en/github/authenticating-to-github/generating-a-new-gpg-key)), чтобы он внес вас в доверенный список лиц. Сам список можно получить командой `git secret whoknows`. Без расшифровки секретов проект локально не запустится!


<a name="dev-rules"></a>

## Локальная разработка
Чтобы запустить локально проект, необходимо:
1. Сначала установить все зависимости проекта командой:
```shell script
yarn 
```
2. Далее запускаем сборку. Чтобы собрать и клиентскую, и серверную часть с продовыми настройками 
необходимо запустить команду:
```shell script
yarn build
``` 
3. После сборки вскрываем секреты:
```
git secret reveal
```
4. Далее сервер запускается командой:
```shell script
yarn start
```
В консоле пишется порт, а также указаывается ссылка, которую уже можно
открыть в браузере и начать работать с приложением. 

Чтобы начать разрабатывать клиентскую чать приложения (frontend) в режиме development, нужно запусть сборщик webpack в режиме _watch_, тогда все изменения буду автоматически транспилироваться и перетикать в бандлы.  
Для этого нужно воспользоваться командой (она запускает просто готовый скрипт из `package.json`):
```shell script
yarn build:front:watch
```
Аналогично, в режиме _dev-server_ можно запустить и серверную часть командой: 
```shell script
yarn start:watch
```
Обращаю внимание, что для разработки frontend-части приложения, сервер должен быть запущен в режиме development (то есть командой `yarn start:wath`).

Также с другими командами и скриптами можно ознакомится в файле `package.json` в разделе _scripts_.

<a name="backend"></a>

## Архитектура backend
Backend часть приложения написана под NodeJS с использованием TS. Весь код нахожится в папке `server`. Запуск сервера конфигурируется папкой `config`. В нем располагются файлы конфигурации приложения, которые применяются для запуска приложения в зависимости от окружения запуска. (Подробнее ознкамится нужно [здесь](https://www.npmjs.com/package/config))

Рассмотрим из чего состоит `server`:
1. `app.ts` - входная точка сервера. Здесь создается простенькое `express` приложение, подключаются различные _middlewares_, а также идет подключение к БД через `mongoose`. Помимо этого здесь подключаются роутинги на обработку конкретных запросов (`app.use(routes.user, userRouter)`). Ну и просхожит запуск самого сервера на определенном порту `app.listen(...)`
2. `routes` - тут уже располагаются обработчики http-запросов. 
- в `index.ts` - формируется список страничек, на которые сервера отслыает сгенерированную самостоятельно html-страничку.
- `user.ts` - обработчики запросов связанных с сущностью `user`
- `provider.ts` - обработчики запрсов связанных с сущностью `provider`, то есть с поставщиком хобби (или партнером по-другому называя)
3. `models` - описанные основные сущности проекта и их хранение в БД `MongoDB` через библиотеку `mongoose`.
- User - непосредственно обычный пользователь приложения
- Provider - партнер, предоставляющий хобби
- Hobby - непосредственно сущность хобби
4. `utils` - утилитки, которые используются в разных частях сервера (например загрузка меда-файлов через aws в облака или формирование html-страничик для отдачи статики пользователю).
