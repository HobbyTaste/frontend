# Интеграционные тесты для backend'а
## Тестирование
Запуск тестов: 
```sh
yarn test
```
Первые несколько секунд будет разворачиваться база данных и запускаться само приложение, потом начнут выполняться тесты. Они разделены на 3 основные группы: работа с партнёром, пользователем и хобби. Разные группы тестов выполняются независимо друг от друга. Для каждого теста выводится результат его выполнения: если тест выполнен успешно, выводится зелёная галочка, его название и, если он выполнялся довольно долго, время выполнения; если тест не пройден — название и текст ошибки.

В тестовом окружении выводятся только логи выполнения тестов, остальные отключены.

## Описание
Все основные вещи, касающиеся тестов, сложены в директории `test`:
- Сами тесты описаны в файлах, заканчивающихся на  "test.ts". Сейчас их 3: `provider.test.ts`, `user.test.ts` и `hobby.test.ts`, в каждом из них описана соответствующая группа тестов. Можно добавлять новые группы тестов, описывая их в файлах вида `<название группы>.test.ts`.
- В директории `data` хранится маленький набор тестовых данных, использующихся для проверки работы контроллеров: 2 партнёра (в файле `providers.json`), 2 пользователя (`users.json`), 2 хобби (`hobbies.json`) и данные для обновления записей (`other_data.json`). Они используются исключительно для проверки функций добавления и изменения данных в базе, для всего осталаьного используются фикстуры — тестовые данные, описанные в директории `fixtures`.
- В файле `utils.ts` описаны полезные функции, не относящиеся напрямую к тестированию, но позволяющие сделать код описания тестов более лаконичным.

Для тестов используется отдельная база данных, разворачиваемая локально в `docker`-контейнере с помощью скрипта `start-db`. Перед каждой группой тестов в неё загужаются фикстуры — тестовые данные, описанные в директории `fixtures`. Файл `.mocharc.json` описывает опции для запуска тестового фреймворка `mocha`, использующегося вместе с `assertion`-библотекой `Chai` и её плагином `chai-http`, позволяющим просто работать с http-запросами.

Для всех тестов выставлен стандартный для `mocha` таймаут в 2 c. Его можно отредактировать для любого теста или группы тестов, прописав таймаут в начале теста/группы:
```javascript
this.timeout(нужный таймаут в мс);
```
На данный момент протестированы все части контроллеров, кроме тех, что предполагают загрузку файлов в облако.